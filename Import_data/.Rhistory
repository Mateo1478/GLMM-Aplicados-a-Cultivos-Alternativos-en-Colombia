df_agricola %>% filter(cultivo=="CAFE") %>% count(ano)
df_agricola %>% filter(cultivo=="CACAO") %>% count(ano)
rendimiento_cafe <- df_agricola %>%
filter(cultivo=="CACAO") %>%
group_by(departamento,ano) %>%
summarise(
prod_cor = sum(produccion),
area_cor = sum(area_sembrada)
) %>%
ungroup() %>% mutate( rend_cor = prod_cor/area_cor )%>% group_by(departamento) %>%  mutate(rendimiento_siguiente = lead(rend_cor),
supero_rendimiento = ifelse(rendimiento_siguiente >= rend_cor, 1, 0))
# Ver el resultado
rendimiento_cafe %>% print(n = 60)
print(rendimiento_cafe)
setwd("C:/Users/USUARIO/Desktop/IDEAM/DATOS_RENDIMIENTO")
library(tidyverse)
library(janitor)
# Leer archivos y limpiar nombres de columnas
df1 <- read_csv("Evaluaciones_Agropecuarias_Municipales_2019_2023.csv", show_col_types = FALSE) %>%
clean_names()
df2 <- read_csv("Evaluaciones_Agropecuarias_Municipales_2007_2018.csv", show_col_types = FALSE) %>%
clean_names()
df2 %>% filter(cultivo=="CACAO") %>% count(ano)
df1 %>% filter(cultivo=="CACAO") %>% count(ano)
df1 %>% filter(cultivo=="CACAO") %>% count(ano)
df1 %>% filter(cultivo=="Cacao") %>% count(ano)
library(tidyverse)
library(janitor)
# Leer archivos y limpiar nombres de columnas
df1 <- read_csv("Evaluaciones_Agropecuarias_Municipales_2019_2023.csv", show_col_types = FALSE) %>%
clean_names()
df2 <- read_csv("Evaluaciones_Agropecuarias_Municipales_2007_2018.csv", show_col_types = FALSE) %>%
clean_names()
df2 %>% filter(cultivo=="CACAO") %>% count(ano)
df1 %>% filter(cultivo=="Cacao") %>% count(ano)
# Renombrar columnas de df2 para que coincidan con df1
df2 <- df2 %>%
rename(
codigo_dane_departamento = cod_dep,
codigo_dane_municipio = cod_mun,
grupo_cultivo = grupo_de_cultivo,
subgrupo = subgrupo_de_cultivo,
desagregacion_cultivo = desagregacion_regional_y_o_sistema_productivo,
area_sembrada = area_sembrada_ha,
area_cosechada = area_cosechada_ha,
produccion = produccion_t,
rendimiento = rendimiento_t_ha,
estado_fisico_del_cultivo = estado_fisico_produccion,
nombre_cientifico_del_cultivo = nombre_cientifico,
ciclo_del_cultivo = ciclo_de_cultivo
)
# Asegurarse de que las columnas estén en el mismo orden y todas presentes
cols_final <- union(names(df1), names(df2))
df1 <- df1 %>%
add_column(
!!!set_names(
rep(list(NA), length(setdiff(cols_final, names(df1)))),
setdiff(cols_final, names(df1))
)
) %>%
select(all_of(cols_final))
df2 <- df2 %>%
add_column(
!!!set_names(
rep(list(NA), length(setdiff(cols_final, names(df2)))),
setdiff(cols_final, names(df2))
)
) %>%
select(all_of(cols_final))
# Estandarizar nombres de cultivos
df1 <- df1 %>%
mutate(
cultivo = str_to_title(cultivo),
codigo_dane_departamento = as.character(codigo_dane_departamento),
codigo_dane_municipio = as.character(codigo_dane_municipio)
)
df2 <- df2 %>%
mutate(
cultivo = str_to_title(cultivo),
codigo_dane_departamento = as.character(codigo_dane_departamento),
codigo_dane_municipio = as.character(codigo_dane_municipio)
)
# Unir y eliminar duplicados
df_agricola <- bind_rows(df1, df2) %>% distinct()
# Vista rápida
glimpse(df_agricola)
save(df_agricola, file = "df_agricola.RData")
load("C:/Users/USUARIO/Desktop/IDEAM/DATOS_RENDIMIENTO/df_agricola.RData")
# Asegurate de tener todos los archivos del shapefile de municipios (.shp, .shx, .dbf, etc.) en la misma carpeta
municipios_mapa <- st_read("C:/Users/USUARIO/Desktop/IDEAM/CultivosMateo/Municipios/Municipios.shp")  # Ajusta la ruta según tu archivo
# Asegurate de tener todos los archivos del shapefile (.shp, .shx, .dbf, etc.) en la misma carpeta
colombia_mapa <- st_read("C:/Users/USUARIO/Desktop/IDEAM/CultivosMateo/departamentos/departamentos.shp")
df_agricola %>% filter(cultivo=="CACAO") %>% count(ano)
df_agricola %>% filter(cultivo=="CACAO") %>% count(ano)
df_agricola %>% filter(cultivo=="Cacao") %>% count(ano)
rendimiento_cafe <- df_agricola %>%
filter(cultivo=="Cafe") %>%
group_by(departamento,ano) %>%
summarise(
prod_cor = sum(produccion),
area_cor = sum(area_sembrada)
) %>%
ungroup() %>% mutate( rend_cor = prod_cor/area_cor )%>% group_by(departamento) %>%  mutate(rendimiento_siguiente = lead(rend_cor),
supero_rendimiento = ifelse(rendimiento_siguiente >= rend_cor, 1, 0))
# Ver el resultado
rendimiento_cafe %>% print(n = 60)
print(rendimiento_cafe)
rendimiento_cacao <- df_agricola %>%
filter(cultivo=="Cacao") %>%
group_by(departamento,ano) %>%
summarise(
prod_cor = sum(produccion),
area_cor = sum(area_sembrada)
) %>%
ungroup() %>% mutate( rend_cor = prod_cor/area_cor )%>% group_by(departamento) %>%  mutate(rendimiento_siguiente = lead(rend_cor),
supero_rendimiento = ifelse(rendimiento_siguiente >= rend_cor, 1, 0))
# Ver el resultado
rendimiento_cacao %>% print(n = 60)
print(rendimiento_cacao)
df_agricola %>%
filter(subgrupo %in% c("Cacao", "Cafe", "Palma de aceite", "Platano", "Yuca")) %>%
group_by(ano, subgrupo) %>%
summarise(
area_sembrada = sum(area_sembrada, na.rm = TRUE),
produccion = sum(produccion, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
rendimiento = produccion / area_sembrada,
tipo = "Sustituto",
ano = as.character(ano)
)
df_agricola %>% glimpse()
cultivos_detalle <- df_agricola %>%
filter(cultivo %in% c("Cacao", "Cafe", "Palma de aceite", "Platano", "Yuca")) %>%
group_by(ano, cultivo) %>%
summarise(
area_sembrada = sum(area_sembrada, na.rm = TRUE),
produccion = sum(produccion, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
rendimiento = produccion / area_sembrada,
tipo = "Sustituto",
ano = as.character(ano)
)
cultivos_detalle
cultivos_detalle %>% print(n=58)
cultivos_rendimiento <- Agropecuarias %>%
filter(cultivo=="CAFE") %>%
group_by(departamento,ano) %>%
summarise(
prod_cor = sum(produccion_t),
area_cor = sum(area_sembrada_ha)
) %>%
ungroup() %>% mutate( rend_cor = prod_cor/area_cor )%>% group_by(departamento) %>%  mutate(rendimiento_siguiente = lead(rend_cor),
supero_rendimiento = ifelse(rendimiento_siguiente >= rend_cor, 1, 0))
# Ver el resultado
cultivos_rendimiento %>% print(n = 60)
print(cultivos_rendimiento)
cultivos_detalle <- df_agricola %>%
filter(cultivo %in% c("Cacao", "Cafe", "Palma de aceite", "Platano", "Yuca")) %>%
group_by(ano, cultivo) %>%
summarise(
area_sembrada = sum(area_sembrada, na.rm = TRUE),
produccion = sum(produccion, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
rendimiento = produccion / area_sembrada,
tipo = "Sustituto",
ano = as.character(ano)
)
cultivos_detalle <- df_agricola %>%
filter(cultivo %in% c("Cacao", "Cafe", "Palma de aceite", "Platano", "Yuca")) %>%
group_by(ano, cultivo) %>%
summarise(
area_sembrada = sum(area_sembrada, na.rm = TRUE),
produccion = sum(produccion, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
rendimiento = produccion / area_sembrada,
tipo = "Sustituto",
ano = as.character(ano)
)
cultivos_detalle
# Crear el indicador de rendimiento
cultivos_rendimiento1 <- cultivos_detalle %>%
arrange(cultivo, ano) %>%
group_by(cultivo) %>%
mutate(
rendimiento_anterior = lag(rendimiento),
supero_rendimiento = ifelse(rendimiento >= rendimiento_anterior, 1, 0)
) %>%
ungroup()
# Ver el resultado
cultivos_rendimiento1 %>% print(n = 60)
print(cultivos_rendimiento1)
library(lme4)
modelo_binario <- glmer(
supero_rendimiento ~ as.numeric(ano) +  prod_cor + (1 + as.numeric(ano)| departamento),
data = na.omit(cultivos_rendimiento)
)
summary(modelo_binario)
modelo_binario2 <- glmer(
supero_rendimiento ~ as.numeric(ano) + area_cor + prod_cor + (1 | departamento),
data = cultivos_rendimiento,
family = binomial(link = "logit")
)
summary(modelo_binario2)
load("C:/Users/USUARIO/Desktop/IDEAM/df_2018_completo.RData")
View(df_2018_completo)
df_2018_completo %>% glimpse()
temp_promedio <- df_2018_completo %>%
group_by(departamento, ano) %>%
summarise(
temperatura_promedio = mean(valorobservado, na.rm = TRUE),
.groups = "drop"
)
df_2018_completo %>%
mutate(
fechaobservacion = as.Date(str_sub(fechaobservacion, 1, 10)), # Recorta solo la fecha
ano = year(fechaobservacion),
valorobservado = as.numeric(valorobservado),
departamento = str_to_title(departamento)  # Asegura consistencia con los demás df
)
# Convertir valores numéricos y extraer año
sensores <- df_2018_completo %>%
mutate(
fechaobservacion = as.Date(str_sub(fechaobservacion, 1, 10)), # Recorta solo la fecha
ano = year(fechaobservacion),
valorobservado = as.numeric(valorobservado),
departamento = str_to_title(departamento)  # Asegura consistencia con los demás df
)
temp_promedio <- sensores %>%
group_by(departamento, ano) %>%
summarise(
temperatura_promedio = mean(valorobservado, na.rm = TRUE),
.groups = "drop"
)
temp_promedio
df_agricola <- df_agricola %>%
mutate(departamento = str_to_title(departamento))  # Si no lo habías hecho ya
df_agricola_temp <- df_agricola %>%
left_join(temp_promedio, by = c("departamento", "ano"))
df_agricola_temp
df_agricola
temp_promedio
temp_promedio %>% print(n=37)
# Convertir valores numéricos y extraer año
sensores <- df_2018_completo %>%
mutate(
fechaobservacion = as.Date(str_sub(fechaobservacion, 1, 10)), # Recorta solo la fecha
ano = year(fechaobservacion),
valorobservado = as.numeric(valorobservado),
departamento = str_to_title(departamento)  # Asegura consistencia con los demás df
)
library(stringi)
temp_promedio <- temp_promedio %>%
mutate(
departamento = str_to_title(departamento),
departamento = str_trim(departamento),  # quita espacios extra
departamento = stri_trans_general(departamento, "Latin-ASCII")  # elimina tildes
)
temp_promedio <- temp_promedio %>%
mutate(
departamento = case_when(
departamento %in% c("Bogota D.c.", "Bogota") ~ "Bogota D.C.",
departamento == "Narino" ~ "Nariño",
departamento == "Cordoba" ~ "Córdoba",
departamento == "Bolivar" ~ "Bolívar",
departamento == "Atlantico" ~ "Atlántico",
departamento == "Choco" ~ "Chocó",
departamento == "San Andres Providencia" ~ "San Andrés y Providencia",
departamento == "<Nil>" ~ NA_character_,
TRUE ~ departamento
)
)
temp_promedio <- temp_promedio %>%
filter(!is.na(departamento)) %>%
group_by(departamento, ano) %>%
summarise(
temperatura_promedio = mean(temperatura_promedio, na.rm = TRUE),
.groups = "drop"
)
temp_promedio
temp_promedio
temp_promedio %>% print(n=30)
# Filtrar ambas bases por año 2018
df_agricola_2018 <- df_agricola %>%
filter(ano == 2018)
temp_promedio_2018 <- temp_promedio %>%
filter(ano == 2018)
# Hacer el join
df_agricola_temp_2018 <- df_agricola_2018 %>%
left_join(temp_promedio_2018, by = c("departamento", "ano"))
# Verificar
glimpse(df_agricola_temp_2018)
df_agricola_temp_2018
df_agricola_temp_2018
cultivos_detalle
rendimiento_cacao
cultivos_rendimiento1
cultivos_rendimiento
cultivos_rendimiento <- cultivos_detalle %>%
filter(cultivo=="Cacao") %>%
group_by(departamento,ano) %>%
summarise(
prod_cor = sum(produccion),
area_cor = sum(area_sembrada)
) %>%
ungroup() %>% mutate( rend_cor = prod_cor/area_cor )%>% group_by(departamento) %>%  mutate(rendimiento_siguiente = lead(rend_cor),
supero_rendimiento = ifelse(rendimiento_siguiente >= rend_cor, 1, 0))
rendimiento_cacao <- df_agricola %>%
filter(cultivo=="Cacao") %>%
group_by(departamento,ano) %>%
summarise(
prod_cor = sum(produccion),
area_cor = sum(area_sembrada)
) %>%
ungroup() %>% mutate( rend_cor = prod_cor/area_cor )%>% group_by(departamento) %>%  mutate(rendimiento_siguiente = lead(rend_cor),
supero_rendimiento = ifelse(rendimiento_siguiente >= rend_cor, 1, 0))
# Ver el resultado
rendimiento_cacao %>% print(n = 60)
print(rendimiento_cacao)
library(lme4)
modelo_binario <- glmer(
supero_rendimiento ~ as.numeric(ano) +  prod_cor + (1 + as.numeric(ano)| departamento),
data = na.omit(rendimiento_cacao)
)
summary(modelo_binario)
rendimiento_cacao <- df_agricola %>%
filter(cultivo=="Cacao") %>%
group_by(departamento,ano) %>%
summarise(
prod_cor = sum(produccion),
area_cor = sum(area_sembrada)
) %>%
ungroup() %>% mutate( rend_cor = prod_cor/area_cor )%>% group_by(departamento) %>%  mutate(rendimiento_siguiente = lead(rend_cor),
supero_rendimiento = ifelse(rendimiento_siguiente >= rend_cor, 1, 0))
# Ver el resultado
rendimiento_cacao %>% print(n = 60)
print(rendimiento_cacao)
cultivos_detalle <- df_agricola %>%
filter(cultivo %in% c("Cacao", "Cafe", "Palma de aceite", "Platano", "Yuca")) %>%
group_by(ano, cultivo) %>%
summarise(
area_sembrada = sum(area_sembrada, na.rm = TRUE),
produccion = sum(produccion, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
rendimiento = produccion / area_sembrada,
tipo = "Sustituto",
ano = as.character(ano)
)
cultivos_detalle
cultivos_detalle <- df_agricola %>%
filter(cultivo %in% c("Cacao", "Cafe", "Palma de aceite", "Platano", "Yuca")) %>%
group_by(ano, cultivo,departamento) %>%
summarise(
area_sembrada = sum(area_sembrada, na.rm = TRUE),
produccion = sum(produccion, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(
rendimiento = produccion / area_sembrada,
tipo = "Sustituto",
ano = as.character(ano)
)
cultivos_detalle
cultivos_detalle %>%
mutate(departamento = str_to_title(departamento))  # Si no lo habías hecho ya
cultivos_detalle_2018 <- cultivos_detalle %>%
filter(ano == 2018)
temp_promedio_2018 <- temp_promedio %>%
filter(ano == 2018)
# Hacer el join
df_agricola_temp_2018 <- cultivos_detalle_2018 %>%
left_join(temp_promedio_2018, by = c("departamento", "ano"))
cultivos_detalle_2018
temp_promedio_2018
cultivos_detalle_2018
# Hacer el join
df_agricola_temp_2018 <- cultivos_detalle_2018 %>%
left_join(temp_promedio_2018, by = c("departamento", "ano"))
# Filtrar ambas bases por año 2018
cultivos_detalle_2018 <- cultivos_detalle %>%
mutate(as.character(ano)) %>%
filter(ano == 2018)
temp_promedio_2018 <- temp_promedio %>%
mutate(as.character(ano)) %>%
filter(ano == 2018)
# Hacer el join
df_agricola_temp_2018 <- cultivos_detalle_2018 %>%
left_join(temp_promedio_2018, by = c("departamento", "ano"))
# Filtrar ambas bases por año 2018
cultivos_detalle_2018 <- cultivos_detalle %>%
mutate(ano = as.character(ano)) %>%
filter(ano == "2018")
temp_promedio_2018 <- temp_promedio %>%
mutate(ano = as.character(ano)) %>%
filter(ano == "2018")
# Hacer el join por departamento y año
df_agricola_temp_2018 <- cultivos_detalle_2018 %>%
left_join(temp_promedio_2018, by = c("departamento", "ano"))
df_agricola_temp_2018
# Convertir valores numéricos y extraer año
sensores <- df_2018_completo %>%
mutate(
fechaobservacion = as.Date(str_sub(fechaobservacion, 1, 10)), # Recorta solo la fecha
ano = year(fechaobservacion),
valorobservado = as.numeric(valorobservado),
departamento = str_to_title(departamento)  # Asegura consistencia con los demás df
)
library(stringi)
temp_promedio <- temp_promedio %>%
mutate(
departamento = str_to_title(departamento),
departamento = str_trim(departamento),  # quita espacios extra
departamento = stri_trans_general(departamento, "Latin-ASCII")  # elimina tildes
)
temp_promedio <- temp_promedio %>%
mutate(
departamento = case_when(
departamento %in% c("Bogota D.c.", "Bogota") ~ "Bogota D.C.",
departamento == "Nariño" ~ "Narino",
departamento == "Córdoba" ~ "Cordoba",
departamento == "Bolívar" ~ "Bolivar",
departamento == "Atlántico" ~ "Atlantico",
departamento == "Chocó" ~ "Choco",
departamento == "San Andrés Providencia" ~ "San Andres y Providencia",
departamento == "<Nil>" ~ NA_character_,
TRUE ~ departamento
)
)
temp_promedio <- temp_promedio %>%
filter(!is.na(departamento)) %>%
group_by(departamento, ano) %>%
summarise(
temperatura_promedio = mean(temperatura_promedio, na.rm = TRUE),
.groups = "drop"
)
temp_promedio
# Filtrar ambas bases por año 2018
cultivos_detalle_2018 <- cultivos_detalle %>%
mutate(ano = as.character(ano)) %>%
filter(ano == "2018")
temp_promedio_2018 <- temp_promedio %>%
mutate(ano = as.character(ano)) %>%
filter(ano == "2018")
# Hacer el join por departamento y año
df_agricola_temp_2018 <- cultivos_detalle_2018 %>%
left_join(temp_promedio_2018, by = c("departamento", "ano"))
df_agricola_temp_2018
temp_promedio
temp_promedio %>% print(n=30)
# Convertir valores numéricos y extraer año
sensores <- df_2018_completo %>%
mutate(
fechaobservacion = as.Date(str_sub(fechaobservacion, 1, 10)), # Recorta solo la fecha
ano = year(fechaobservacion),
valorobservado = as.numeric(valorobservado),
departamento = str_to_title(departamento)  # Asegura consistencia con los demás df
)
library(stringi)
temp_promedio <- temp_promedio %>%
mutate(
departamento = str_to_title(departamento),
departamento = str_trim(departamento),  # quita espacios extra
departamento = stri_trans_general(departamento, "Latin-ASCII")  # elimina tildes
)
temp_promedio <- temp_promedio %>%
mutate(
departamento = case_when(
departamento %in% c("Bogota D.c.", "Bogota") ~ "Bogota D.C.",
departamento == "Nariño" ~ "Narino",
departamento == "Córdoba" ~ "Cordoba",
departamento == "Bolívar" ~ "Bolivar",
departamento == "Atlántico" ~ "Atlantico",
departamento == "Chocó" ~ "Choco",
departamento == "San Andrés Providencia" ~ "San Andres y Providencia",
departamento == "Vaupés" ~ "Vaupes"
departamento == "<Nil>" ~ NA_character_,
TRUE ~ departamento
)
)
temp_promedio <- temp_promedio %>%
filter(!is.na(departamento)) %>%
group_by(departamento, ano) %>%
summarise(
temperatura_promedio = mean(temperatura_promedio, na.rm = TRUE),
.groups = "drop"
)
temp_promedio
# Filtrar ambas bases por año 2018
cultivos_detalle_2018 <- cultivos_detalle %>%
mutate(ano = as.character(ano)) %>%
filter(ano == "2018")
temp_promedio_2018 <- temp_promedio %>%
mutate(ano = as.character(ano)) %>%
filter(ano == "2018")
# Hacer el join por departamento y año
df_agricola_temp_2018 <- cultivos_detalle_2018 %>%
left_join(temp_promedio_2018, by = c("departamento", "ano"))
df_agricola_temp_2018
temp_promedio.
temp_promedio
temp_promedio %>% names(departamento)
temp_promedio %>% count(departamento)
temp_promedio %>% count(departamento) %>% print(n=30)
